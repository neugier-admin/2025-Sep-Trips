<!DOCTYPE html>
<html lang="zh-Hant" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÊàëÁöÑÂ§ßÈò™‰πãÊóÖ 2025</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chosen Palette: Calm Blue & Neutral Gray -->
    <!-- Application Structure Plan: The application is a two-layer single-page app (SPA). The main page acts as a dashboard, offering a high-level overview of the trip (daily themes) and a task-oriented "Foodie Checklist". This encourages exploration without overwhelming the user. Clicking a day card drills down into a detailed timeline view, which slides in from the right‚Äîa common and intuitive mobile navigation pattern. This layered structure presents information contextually, making it highly usable on the go. -->
    <!-- Visualization & Content Choices: The source report is a detailed travel itinerary. The goal is organization, quick access to information, and task management. 
         - Daily Itinerary -> Goal: Organize/Inform. Method: Clickable Cards (HTML/Tailwind). Interaction: Tap to drill-down. Justification: Provides a scannable, high-level summary. Cards are an excellent touch target for mobile users.
         - Detailed Timeline -> Goal: Organize/Inform. Method: Vertical Timeline (HTML/Tailwind). Interaction: Scroll, click map links. Justification: Chronological presentation is the most intuitive way to view a schedule. Integrating actionable transport info and map links directly into each step makes the app a practical tool.
         - (UPGRADED) Foodie Section -> Goal: Discovery/Personalization. Method: Gemini API Integration (JS). Interaction: Click "AI Suggest" button. Justification: Adds a dynamic, intelligent feature that provides personalized, non-seafood restaurant recommendations based on the user's existing list, enhancing the trip's culinary discovery aspect.
         - (REMOVED) Dark Mode Toggle -> Goal: Stability/Simplicity. Method: Removed JS toggle, hardcoded 'dark' class. Justification: Per user request, this removes the buggy toggle feature and sets the app to a permanent dark theme for a consistent experience.
         - Icon System -> Goal: Decoupling/Performance. Method: Inline SVG function (JS). Interaction: None (internal). Justification: Removes external library dependency, improves performance, and makes the codebase more robust and ready for future framework migration (e.g., to React/TSX).
         - Library/Method: All elements are implemented using HTML, Tailwind CSS, and Vanilla JavaScript for a lightweight and fast experience. Icons are now self-contained. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        .timeline-item::before {
            content: '';
            position: absolute;
            left: 1.25rem;
            top: 1.75rem;
            bottom: -1.75rem;
            width: 2px;
            background-color: #e5e7eb; 
        }
        .dark .timeline-item::before {
            background-color: #4b5563; /* dark:bg-gray-600 */
        }
        .timeline-item:last-child::before {
            display: none;
        }
        .page {
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .page-hidden {
            transform: translateX(100%);
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .loader-small {
            border: 2px solid #374151; /* dark:border-gray-700 */
            border-top: 2px solid #60a5fa; /* dark:border-blue-400 */
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        .gemini-loader {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #4f46e5;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        /* Hide scrollbar for a cleaner, more app-like look */
        .hide-scrollbar {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }
        .hide-scrollbar::-webkit-scrollbar {
            display: none; /* Chrome, Safari and Opera */
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-200">

    <div id="app-container" class="relative h-screen w-full max-w-lg mx-auto bg-gray-800 overflow-hidden shadow-2xl flex flex-col">

        <div id="main-page-wrapper" class="flex flex-col flex-grow h-full">
            <header class="flex-shrink-0 bg-gray-800/80 backdrop-blur-sm z-20 px-4 sm:px-6 py-4 border-b border-gray-700 flex items-center justify-center relative">
                <h1 id="main-title" class="text-2xl font-bold text-gray-100"></h1>
            </header>

            <main class="flex-grow overflow-y-auto p-6 hide-scrollbar">
                <section id="itinerary-view" class="space-y-4"></section>
                <section id="foodie-view" class="hidden space-y-6"></section>
                <section id="coupon-view" class="hidden space-y-6"></section>
            </main>
            
            <nav class="flex-shrink-0 bg-gray-800/90 backdrop-blur-sm border-t border-gray-700 z-20">
                 <div id="nav-container" class="flex justify-around">
                     <!-- Navigation buttons will be rendered here by JavaScript -->
                 </div>
            </nav>
        </div>

        <!-- Detail Page -->
        <div id="detail-page" class="page page-hidden absolute inset-0 bg-gray-800 z-30 flex flex-col">
            <header id="detail-header" class="flex-shrink-0 bg-gray-800/80 backdrop-blur-sm z-10 px-4 py-4 border-b border-gray-700 flex items-center">
                 <!-- Detail header content will be rendered here by JavaScript -->
            </header>
            <div id="detail-content" class="flex-grow overflow-y-auto hide-scrollbar"></div>
        </div>
        
        <!-- Coupon Modal -->
        <div id="coupon-modal" class="fixed inset-0 bg-black bg-opacity-75 z-40 flex items-center justify-center p-4 hidden">
            <div id="coupon-modal-content" class="relative bg-gray-800 rounded-lg max-w-lg w-full">
                 <!-- Coupon modal content will be rendered here by JavaScript -->
            </div>
        </div>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- (NEW) Application State Management ---
            // Centralized state object to hold dynamic data like weather.
            // This avoids polluting the global (window) scope and is a better practice.
            const appState = {
                weatherByLocation: {}
            };

            // --- SVG Icon System ---
            function getIconSvg(name, options = {}) {
                const { classes = 'w-6 h-6', strokeWidth = 2 } = options;
                const icons = {
                    'list-ordered': `<line x1="10" x2="21" y1="6" y2="6"/><line x1="10" x2="21" y1="12" y2="12"/><line x1="10" x2="21" y1="18" y2="18"/><path d="M4 6h1v4"/><path d="M4 10h2"/><path d="M6 18H4l2-4H4l2-4"/>`,
                    'utensils-crossed': `<path d="m16 2-2.3 2.3a3 3 0 0 0 0 4.2l1.8 1.8a3 3 0 0 0 4.2 0L22 8Z"/><path d="M15 15 3.3 3.3a4.2 4.2 0 0 0 0 6l7.3 7.3c.7.7 2 .7 2.8 0L15 15Zm0 0 7 7"/><path d="m2.1 2.1 6.4 6.4"/>`,
                    'ticket': `<path d="M2 9a3 3 0 0 1 0 6v2a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-2a3 3 0 0 1 0-6V7a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z"/><path d="M13 5v2"/><path d="M13 17v2"/><path d="M13 11v2"/>`,
                    'arrow-left': `<path d="m12 19-7-7 7-7"/><path d="M19 12H5"/>`,
                    'x': `<path d="M18 6 6 18"/><path d="m6 6 12 12"/>`,
                    'map-pin': `<path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/>`,
                    'bell-ring': `<path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9"/><path d="M10.3 21a1.94 1.94 0 0 0 3.4 0"/><path d="M4 2C2.8 3.7 2 5.7 2 8"/><path d="M20 8c0-2.3-.8-4.3-2-6"/>`,
                    'alert-triangle': `<path d="m21.73 18-8-14a2 2 0 0 0-3.46 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><path d="M12 9v4"/><path d="M12 17h.01"/>`,
                    'tram-front': `<rect width="16" height="16" x="4" y="3" rx="2"/><path d="M4 11h16"/><path d="M12 3v-2"/><path d="M8 19v2"/><path d="M16 19v2"/><path d="M12 19v-3h-2a2 2 0 0 0-2 2v1h6v-1a2 2 0 0 0-2-2Z"/>`,
                    'plug-zap': `<path d="M13 2v8h6"/><path d="M12 12h-2a4 4 0 0 1-4-4V2"/><path d="M8 18v-2.5"/><path d="M10 10l-2 2.5"/><path d="M14 10l2 2.5"/><path d="M12 22v-6"/><path d="M7 12H2"/><path d="M17 12h5"/>`,
                    'pilcrow': `<path d="M13 4v16"/><path d="M17 4v16"/><path d="M19 4H9.5a4.5 4.5 0 0 0 0 9H13"/>`,
                    'shopping-bag': `<path d="M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z"/><path d="M3 6h18"/><path d="M16 10a4 4 0 0 1-8 0"/>`,
                    'gem': `<path d="M6 3h12l4 6-10 13L2 9Z"/><path d="M12 22V9"/><path d="m3.29 9 8.71 13 8.71-13L12 3Z"/>`,
                    'shopping-cart': `<circle cx="8" cy="21" r="1"/><circle cx="19" cy="21" r="1"/><path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.16"/>`,
                    'image': `<rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><circle cx="9" cy="9" r="2"/><path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"/>`,
                    'link-2': `<path d="M9 17H7A5 5 0 0 1 7 7h2"/><path d="M15 7h2a5 5 0 1 1 0 10h-2"/><line x1="8" x2="16" y1="12" y2="12"/>`,
                    'sparkles': `<path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/><path d="M5 3v4"/><path d="M19 17v4"/><path d="M3 5h4"/><path d="M17 19h4"/>`
                };

                const svgContent = icons[name] || '';
                return `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="${strokeWidth}" stroke-linecap="round" stroke-linejoin="round" class="${classes}">${svgContent}</svg>`;
            }

            // --- DATA SOURCE ---
            const tripData = {
              "tripTitle": "Â§ßÈò™ 2025",
              "locations": { "Osaka": { "lat": 34.69, "lon": 135.50 }, "Kishiwada": { "lat": 34.46, "lon": 135.37 }, "Kyoto": { "lat": 35.01, "lon": 135.76 }, "Ise": { "lat": 34.49, "lon": 136.71 }, "Iga": { "lat": 34.77, "lon": 136.13 }, "Nagoya": { "lat": 35.18, "lon": 136.91 } },
              "itinerary": [
                   { "day": 1, "date": "2025-09-13", "theme": "Â≤∏ÂíåÁî∞Á•≠ÂÖ∏", "location": "Kishiwada", "activities": [ {"time": "Áï∂Êó•‰ΩèÂÆø", "title": "ROZY HOTEL NAMBA", "description": "ÊóÖÁ®ãÁ¨¨‰∏Ä„ÄÅ‰∫åÊó•ÁöÑ‰∏ãÊ¶ªÈÖíÂ∫ó„ÄÇ", "transport": "‰ΩçÊñºÈõ£Ê≥¢Âú∞ÂçÄÔºå‰∫§ÈÄö‰æøÂà©„ÄÇ", "mapLink": "https://www.google.com/maps/search/?api=1&query=ROZY+HOTEL+NAMBA"}, {"time": "05:50", "title": "ÊäµÈÅîÈóúË•øÊ©üÂ†¥ (MM068)", "description": "Ëà™Áè≠ MM068 ÂæûÈ¶ôÊ∏ØÊäµÈÅî„ÄÇËæ¶ÁêÜÂÖ•Â¢ÉÊâãÁ∫å„ÄÅÈ†òÂèñË°åÊùéÔºåÊ∫ñÂÇôÈñãÂßãÊóÖÁ®ãÔºÅ", "transport": "ÂæûÈóúË•øÊ©üÂ†¥ (KIX) Êê≠‰πòÂçóÊµ∑ÈõªÈêµ (Nankai Railway) ÂâçÂæÄ„ÄéÂçóÊµ∑Èõ£Ê≥¢Á´ô„Äè(Á¥Ñ45ÂàÜÈêò)„ÄÇ", "mapLink": "https://www.google.com/maps/search/?api=1&query=Kansai+International+Airport"}, {"time": "‰∏äÂçà", "title": "ÂâçÂæÄÈÖíÂ∫ó & Check-in", "description": "ÂâçÂæÄ ROZY HOTEL NAMBA Ëæ¶ÁêÜÂÖ•‰ΩèÊàñÂØÑÂ≠òË°åÊùé„ÄÇ", "transport": "Âæû„ÄéÂçóÊµ∑Èõ£Ê≥¢Á´ô„ÄèÊ≠•Ë°åÊàñÁü≠Á®ã‰∫§ÈÄöËá≥ÈÖíÂ∫ó„ÄÇ", "mapLink": "https://www.google.com/maps/search/?api=1&query=ROZY+HOTEL+NAMBA"}, {"time": "‰∏≠Âçà", "title": "Êó•Êú¨Ê©ãÂãïÊº´Êé¢Èö™", "description": "ÈÖíÂ∫óÂÆâÈ†ìÂ•ΩÂæåÔºåÊ≠•Ë°åÂâçÂæÄË¢´Á®±ÁÇ∫„ÄéÈõªÈõªÂüé„ÄèÁöÑÊó•Êú¨Ê©ã„ÄÇÈÄôË£°ÁöÑÂ∫óËàñÁ¥ÑÂú®11ÈªûÂæåÈô∏Á∫åÈñãÈñÄÔºåÊòØÂãïÊº´Ëø∑ÂíåÈõªÁé©Ëø∑ÁöÑÂ§©Â†Ç„ÄÇ", "transport": "ÂæûÈõ£Ê≥¢ÈÖíÂ∫óÊ≠•Ë°åÂâçÂæÄ (Á¥Ñ10-15ÂàÜÈêò)„ÄÇ", "mapLink": "https://www.google.com/maps/search/?api=1&query=Nipponbashi+Den+Den+Town"}, {"time": "‰∏ãÂçà (Á¥Ñ 14:00 Âæå)", "title": "Â≤∏ÂíåÁî∞„Å†„Çì„Åò„ÇäÁ•≠ (ÂçàÂæåÊõ≥Ë°å)", "description": "ÂâçÂæÄÂ≤∏ÂíåÁî∞ÊÑüÂèóÁ•≠ÂÖ∏ÊúÄÂà∫ÊøÄÁöÑ„ÄéÂçàÂæåÊõ≥Ë°å„Äè„ÄÇÊúÄ‰Ω≥ËßÄË≥ûÂú∞ÈªûÊòØ„Äé„Ç´„É≥„Ç´„É≥Â†¥„ÄèÂçÅÂ≠óË∑ØÂè£ÔºåÈ´îÈ©óÂú∞ËªäÈ´òÈÄüÈÅéÂΩéÁöÑÈúáÊíºÂäõ„ÄÇ", "transport": "Âæû„ÄéÂçóÊµ∑Èõ£Ê≥¢Á´ô„ÄèÊê≠‰πòÂçóÊµ∑Êú¨Á∑öÂâçÂæÄ„ÄéÂ≤∏ÂíåÁî∞Á´ô„Äè(Á¥Ñ30ÂàÜÈêò)„ÄÇ", "mapLink": "https://www.google.com/maps/search/?api=1&query=Kishiwada+Kankanba"}, {"time": "ÂÇçÊôö (ÊôöÈ§êÊôÇÈñì)", "title": "Á•≠ÂÖ∏Â±ãÂè∞ÁæéÈ£üÈ´îÈ©ó", "description": "Âú®‰∏ãÂçàËàáÂ§úÊôöÂ∑°ÈÅäÁöÑÁ©∫Ê™îÔºåÊñºÁ•≠ÂÖ∏ÁöÑÂ±ãÂè∞(Â∞èÈ£üÊî§)Ëß£Ê±∫ÊôöÈ§êÔºåÂìÅÂöêÁ´†È≠öÁáí„ÄÅÁÇíÈ∫µÁ≠âÂú∞ÈÅìÁ•≠ÂÖ∏ÁæéÈ£ü„ÄÇ", "transport": "Á•≠ÂÖ∏ÊúÉÂ†¥Âë®ÈÇä", "mapLink": "https://www.google.com/maps/search/?api=1&query=Kishiwada+Kankanba"}, {"time": "Â§úÊôö (19:00 Âæå)", "title": "ÁÅØÂÖ•„ÇåÊõ≥Ë°å (ÁáàÁ±†Â∑°ÈÅä)", "description": "Ê¨£Ë≥ûËàáÁôΩÂ§©Êà™ÁÑ∂‰∏çÂêåÁöÑÂ§¢ÂπªÊôØË±°„ÄÇÊé®Ëñ¶Âú®„ÄéÂ≤∏ÂíåÁî∞ÂüéÂë®Ëæ∫„ÄèÊàñ„ÄéÂ≤∏ÂíåÁî∞ÈßÖÂâçÈÄöÂïÜÂ∫óË°ó„ÄèËßÄË≥ûÔºåÊÑüÂèóÊéõÊªøÁáàÁ±†ÁöÑÂú∞ËªäÂú®Â§úËâ≤‰∏≠Á∑©ÊÖ¢Â∑°ÈÅäÁöÑÂÑ™ÈõÖËàáÊ∫´È¶®Ê∞£Ê∞õ„ÄÇ", "transport": "Âæû„ÄéÂ≤∏ÂíåÁî∞Á´ô„ÄèÊê≠‰πòÂçóÊµ∑Êú¨Á∑öËøîÂõû„ÄéÂçóÊµ∑Èõ£Ê≥¢Á´ô„Äè(Á¥Ñ30ÂàÜÈêò)„ÄÇ", "mapLink": "https://www.google.com/maps/search/?api=1&query=Kishiwada+Castle"} ] },
                   { "day": 2, "date": "2025-09-14", "theme": "ONE OK ROCK DETOX 2025", "location": "Osaka", "activities": [ {"time": "Áï∂Êó•‰ΩèÂÆø", "title": "ROZY HOTEL NAMBA", "description": "ÊóÖÁ®ãÁ¨¨‰∏Ä„ÄÅ‰∫åÊó•ÁöÑ‰∏ãÊ¶ªÈÖíÂ∫ó„ÄÇ", "transport": "‰ΩçÊñºÈõ£Ê≥¢Âú∞ÂçÄÔºå‰∫§ÈÄö‰æøÂà©„ÄÇ", "mapLink": "https://www.google.com/maps/search/?api=1&query=ROZY+HOTEL+NAMBA"}, {"time": "‰∏äÂçà", "title": "ÂøÉÈΩãÊ©ã PARCO Ë≥ºÁâ©", "description": "ÂæûÈõ£Ê≥¢ÂâçÂæÄÂøÉÈΩãÊ©ãÔºåÁõ¥ÈÅî PARCO ÁôæË≤®„ÄÇÈÄôË£°ÈõÜÁµê‰∫ÜÊΩÆÊµÅ„ÄÅÂãïÊº´„ÄÅËóùË°ìÔºåÂèØ‰ª•Áõ¥Ë°ù6Ê®ìÁöÑCAPCOM STORE„ÄÇ", "transport": "Âæû Osaka Metro„ÄéÈõ£Ê≥¢Á´ô„ÄèÊê≠‰πòÂæ°Â†ÇÁ≠ãÁ∑öÂâçÂæÄ„ÄéÂøÉÈΩãÊ©ãÁ´ô„Äè(Á¥Ñ2ÂàÜÈêò)„ÄÇ", "mapLink": "https://www.google.com/maps/search/?api=1&query=Shinsaibashi+PARCO"}, {"time": "‰∏ãÂçà", "title": "ÊèêÊó©ÂâçÂæÄÈï∑Â±Ö & Ë≥ºË≤∑Âë®ÈÇäÂïÜÂìÅ", "description": "ÊèêÊó©ÂâçÂæÄÈï∑Â±ÖÂÖ¨ÂúíÔºåÊÑüÂèóÊºîÂî±ÊúÉÊ∞£Ê∞õ‰∏¶ÊéíÈöäË≥ºË≤∑ÂÆòÊñπÂë®ÈÇäÂïÜÂìÅ (Goods)„ÄÇ", "transport": "Âæû Osaka Metro„ÄéÂøÉÈΩãÊ©ãÁ´ô„ÄèÊê≠‰πòÂæ°Â†ÇÁ≠ãÁ∑öÂâçÂæÄ„ÄéÈï∑Â±ÖÁ´ô„Äè(Á¥Ñ15ÂàÜÈêò)„ÄÇ", "mapLink": "https://www.google.com/maps/search/?api=1&query=Yanmar+Stadium+Nagai"}, {"time": "17:30", "title": "ONE OK ROCK 2025 TOUR \"DETOX\"", "description": "17:30ÈñãÊºî„ÄÇÊ∫ñÂÇôÂÖ•Â†¥Ôºå‰∫´Âèó‰∏ÄÂ†¥ÁÜ±Ë°ÄÊ≤∏È®∞ÁöÑÊêñÊªæÊºîÂî±ÊúÉÔºÅ", "transport": "Âæû Osaka Metro„ÄéÈõ£Ê≥¢Á´ô„ÄèÊê≠‰πòÂæ°Â†ÇÁ≠ãÁ∑ö (Midosuji Line) ÂâçÂæÄ„ÄéÈï∑Â±ÖÁ´ô„Äè„ÄÇ", "mapLink": "https://www.google.com/maps/search/?api=1&query=Yanmar+Stadium+Nagai"} ], "optionalActivities": [ {"title": "teamLab Botanical Garden (Â§úÈñì)", "description": "ÊºîÂî±ÊúÉÂæåÂèØËÄÉÊÖÆÂâçÂæÄ„ÄÇÂ†¥È§®Âú®Èï∑Â±ÖÂÖ¨ÂúíÂÖßÔºåÊ≠•Ë°åÂèØÈÅî„ÄÇÊúÄÂæåÂÖ•Â†¥ÊôÇÈñìÁÇ∫ 21:30ÔºåÊôÇÈñìÊúÉÈùûÂ∏∏Á∑äÊπäÔºåË´ãËá™Ë°åÊñüÈÖå„ÄÇ", "mapLink": "https://www.google.com/maps/search/?api=1&query=teamLab+Botanical+Garden+Osaka"} ] },
                   { "day": 3, "date": "2025-09-15", "theme": "ÈÖíÂ∫óËΩâÁßª & Ë≥ºÁâ©Êó•", "location": "Osaka", "activities": [ {"time": "‰∏äÂçà / ‰ΩèÂÆø", "title": "ÂÖ•‰Ωè: Êù±Ê©´INN Â§ßÈò™Ê¢ÖÁî∞Êù±", "description": "ÂæûÈõ£Ê≥¢ÈÖíÂ∫óÈÄÄÊàøÔºåÂâçÂæÄÊ¢ÖÁî∞Êñ∞ÈÖíÂ∫óËæ¶ÁêÜÂÖ•‰Ωè‰∏¶ÂØÑÂ≠òË°åÊùé„ÄÇ", "transport": "Âæû Osaka Metro„ÄéÈõ£Ê≥¢Á´ô„ÄèÊê≠‰πòÂæ°Â†ÇÁ≠ãÁ∑öÂà∞„ÄéÊ¢ÖÁî∞Á´ô„ÄèÔºåÂÜçËΩâ‰πòË∞∑Áî∫Á∑öÂà∞„ÄéÊù±Ê¢ÖÁî∞Á´ô„ÄèÂæåÊ≠•Ë°å (Á∏ΩÁ®ãÁ¥Ñ20ÂàÜÈêò)„ÄÇ", "mapLink": "https://www.google.com/maps/search/?api=1&query=Toyoko+Inn+Osaka+Umeda+Higashi"}, {"time": "‰∏ãÂçà", "title": "Ê¢ÖÁî∞Ë≥ºÁâ©Êé¢Á¥¢", "description": "ÂâçÂæÄÊ¢ÖÁî∞Âú∞Ê®ô‰πã‰∏ÄÁöÑ HEP FIVE ÂïÜÂ†¥ÔºåÂèØ‰ª•‰πòÂùêÁ¥ÖËâ≤Êë©Â§©Ëº™„ÄÇ‰πãÂæåÂú®Èò™ÊÄ•ÁôæË≤®„ÄÅÂ§ß‰∏∏Ê¢ÖÁî∞Â∫óÁ≠âÂ§ßÂûãÁôæË≤®ÂÖ¨Âè∏ÈÄõË°ó„ÄÇ", "transport": "ÂæûÈÖíÂ∫óÊ≠•Ë°åÊàñÊê≠‰πòÂú∞ÈêµËá≥„ÄéÊ¢ÖÁî∞Á´ô„Äè„ÄÇ", "mapLink": "https://www.google.com/maps/search/?api=1&query=HEP+FIVE"}, {"time": "ÂÇçÊôö", "title": "Ê¢ÖÁî∞ÊôöÈ§êËàáÂ§úÊôØ", "description": "Âú®ÈÖíÂ∫ó Check-in ÂæåÔºåÂèØ‰ª•ËÄÉÊÖÆÁôª‰∏äÊ¢ÖÁî∞ËóçÂ§©Â§ßÂªàÁúãÂ§úÊôØÔºå‰∏¶Âú®ÈôÑËøë‰∫´Áî®ÊôöÈ§ê„ÄÇ", "transport": "Ê≠•Ë°åÊàñÁü≠Á®ã‰∫§ÈÄö„ÄÇ", "mapLink": "https://www.google.com/maps/search/?api=1&query=Umeda+Sky+Building"} ], "optionalActivities": [ {"title": "EST („Ç®„Çπ„Éà)", "description": "ÈõÜÁµê‰∫ÜÁúæÂ§öÂπ¥Ëºï‰∫∫ÂñúÊÑõÁöÑÊúçÈ£æÂìÅÁâåÔºåÊòØÂ∞ãÊâæÂπ≥ÂÉπÊΩÆÊµÅÂñÆÂìÅÁöÑÂ•ΩÂéªËôï„ÄÇ", "mapLink": "https://www.google.com/maps/search/?api=1&query=EST+Osaka"}, {"title": "EDION (LINKS UMEDAÂ∫ó)", "description": "Â§ßÂûãÈõªÂô®ÈÄ£ÈéñÂ∫óÔºåËÄ≥Ê©üÈÅ∏Êìá‰πüÂæàÂ§öÔºåÊòØÊ¢ÖÁî∞Âú∞ÂçÄÁöÑÂ•ΩÈÅ∏Êìá„ÄÇ", "mapLink": "https://www.google.com/maps/search/?api=1&query=EDION+LINKS+UMEDA"} ] },
                   { "day": 4, "date": "2025-09-16", "theme": "Â§ßÈò™Ëê¨Âçö EXPO 2025 (Á¨¨‰∏ÄÂõû)", "location": "Osaka", "notes": ["Ê≥®ÊÑèÔºöÈÉ®ÂàÜÁÜ±ÈñÄÂ†¥È§®ÂèØËÉΩÈúÄË¶ÅÈ†êÁ¥ÑÊàñÊäΩÈÅ∏ÔºåË´ãÁïôÊÑèÂÆòÊñπÂÖ¨‰Ωà„ÄÇ"], "activities": [ {"time": "Áï∂Êó•‰ΩèÂÆø", "title": "Êù±Ê©´INN Â§ßÈò™Ê¢ÖÁî∞Êù±", "description": "ÊóÖÁ®ãÁ¨¨‰∏âËá≥ÂçÅÊó•ÁöÑ‰∏ãÊ¶ªÈÖíÂ∫ó„ÄÇ", "transport": "‰ΩçÊñºÊ¢ÖÁî∞Êù±Âú∞ÂçÄÔºåÈÑ∞ËøëÂú∞ÈêµÁ´ô„ÄÇ", "mapLink": "https://www.google.com/maps/search/?api=1&query=Toyoko+Inn+Osaka+Umeda+Higashi"}, {"time": "09:00", "title": "ÊäµÈÅîÂ§¢Ê¥≤ÊúÉÂ†¥", "description": "Ê∫ñÊôÇ‰πùÈªûÂà∞ÈÅîÊúÉÂ†¥ÔºåÊ∫ñÂÇôËøéÊé•Êú™‰æÜÁöÑË°ùÊìäÔºÅ", "transport": "Âª∫Ë≠∞Á¥Ñ 08:00 ÂæûÈÖíÂ∫óÂá∫Áôº„ÄÇÂæû„ÄéÊù±Ê¢ÖÁî∞Á´ô„ÄèÊê≠‰πòË∞∑Áî∫Á∑öÂà∞„ÄéË∞∑Áî∫Âõõ‰∏ÅÁõÆÁ´ô„ÄèÔºåËΩâ‰πò‰∏≠Â§ÆÁ∑öÂâçÂæÄ„ÄéÂ§¢Ê¥≤Á´ô„Äè(Á∏ΩÁ®ãÁ¥Ñ45-60ÂàÜÈêò)„ÄÇ", "mapLink": "https://www.google.com/maps/search/?api=1&query=Yumeshima+Station+Osaka"}, {"time": "‰∏ãÂçà", "title": "Êé¢Á¥¢‰∏ªÈ°åÂ±ïÈ§®", "description": "ÂèÉËßÄÊÑüËààË∂£ÁöÑÂúãÂÆ∂È§®Êàñ‰∏ªÈ°åÈ§®Ôºå‰æãÂ¶Ç„ÄéÊú™‰æÜÁ§æÊúÉÁöÑË©¶È©óÂ†¥„ÄèÔºåÈ´îÈ©óÂ∞ñÁ´ØÁßëÊäÄ„ÄÇ", "transport": "ÂúíÂçÄÂÖßÊ≠•Ë°åÊàñÊê≠‰πòÊé•ÈßÅËªä„ÄÇ", "mapLink": "https://www.google.com/maps/search/?api=1&query=Expo+2025+Osaka"}, {"time": "ÂÇçÊôö", "title": "Â§úÈñìÂÖâÂΩ±ÁßÄËàáËøîÂõû", "description": "Ê¨£Ë≥ûÂúíÂçÄÂ§úÈñìÁöÑÁáàÂÖâËóùË°ìËàáË°®ÊºîÔºå‰πãÂæåÊê≠‰πòÂú∞ÈêµËøîÂõûÊ¢ÖÁî∞„ÄÇ", "transport": "Âæû„ÄéÂ§¢Ê¥≤Á´ô„ÄèÊê≠‰πòÂú∞ÈêµËøîÂõû„ÄéË∞∑Áî∫Âõõ‰∏ÅÁõÆÁ´ô„ÄèÂÜçËΩâ‰πòË∞∑Áî∫Á∑ö (Á∏ΩÁ®ãÁ¥Ñ45-60ÂàÜÈêò)„ÄÇ", "mapLink": "https://www.google.com/maps/search/?api=1&query=Yumeshima+Station+Osaka"} ] },
                   { "day": 5, "date": "2025-09-17", "theme": "USJ", "location": "Osaka", "notes": ["Ê≥®ÊÑèÔºöÁ¢∫ÂØ¶ÁöÑÊ¥ªÂãïÊôÇÈñìË°®ÔºåË´ãÊñºÂá∫ÁôºÂâç7Êó•Âà∞ÂÆòÁ∂≤Á¢∫Ë™ç„ÄÇ"], "activities": [ {"time": "Áï∂Êó•‰ΩèÂÆø", "title": "Êù±Ê©´INN Â§ßÈò™Ê¢ÖÁî∞Êù±", "description": "ÊóÖÁ®ãÁ¨¨‰∏âËá≥ÂçÅÊó•ÁöÑ‰∏ãÊ¶ªÈÖíÂ∫ó„ÄÇ", "transport": "‰ΩçÊñºÊ¢ÖÁî∞Êù±Âú∞ÂçÄÔºåÈÑ∞ËøëÂú∞ÈêµÁ´ô„ÄÇ", "mapLink": "https://www.google.com/maps/search/?api=1&query=Toyoko+Inn+Osaka+Umeda+Higashi"}, {"time": "Ê∏ÖÊô® (7:00)", "title": "ÊèêÊó©Âá∫ÁôºÔºåÊê∂‰ΩîÂÖàÊ©ü", "description": "È†êË®à7ÈªûÂà∞ÈÅîUSJÈñÄÂè£ÊéíÈöäÔºåÈñãÂúíÂæåÁ¨¨‰∏ÄÊôÇÈñìË°ùÂéªÊéí„ÄéSPY x FAMILY ÁßòÂØÜ‰ªªÂãô 4D„Äè„ÄÇ", "transport": "Âæû„ÄéÊù±Ê¢ÖÁî∞Á´ô„ÄèÊê≠‰πòË∞∑Áî∫Á∑öÂà∞„ÄéÂ§©ÁéãÂØ∫Á´ô„ÄèÔºåËΩâ‰πòJRÂ§ßÈò™Áí∞ÁãÄÁ∑öÂà∞„ÄéË•ø‰πùÊù°Á´ô„ÄèÔºåÂÜçËΩâ‰πòJRÊ´ªÂ≥∂Á∑öÂà∞„ÄéÁí∞ÁêÉÂΩ±ÂüéÁ´ô„Äè(Á∏ΩÁ®ãÁ¥Ñ40ÂàÜÈêò)„ÄÇ", "mapLink": "https://www.google.com/maps/search/?api=1&query=Universal+Studios+Japan"}, {"time": "11:10 - 12:10", "title": "Express Pass: Ë∂ÖÁ¥ö‰ªªÂ§©Â†Ç‰∏ñÁïå‚Ñ¢", "description": "Ê†πÊìöExpress PassÊôÇÈñìÊ∫ñÊôÇÈÄ≤ÂÖ•ÂúíÂçÄÔºÅÂÖàÁé© 11:10-11:40 ÁöÑ„ÄåÁë™Âà©Ê≠êË≥ΩËªä„ÄçÔºåÂÜçÁé© 11:40-12:10 ÁöÑ„ÄåÊ£ÆÂñúÂâõÁöÑÁòãÁãÇÁ∫úËªä„Äç„ÄÇ", "transport": "ÂúíÂçÄÂÖßÊ≠•Ë°å„ÄÇ", "mapLink": "https://www.google.com/maps/search/?api=1&query=Super+Nintendo+World+Japan"}, {"time": "‰∏≠Âçà", "title": "ÂçàÈ§ê & Á∂ìÂÖ∏ÂúíÂçÄ", "description": "Âú®ÂúíÂçÄÂÖß‰∫´Áî®ÂçàÈ§ê„ÄÇÈ§êÂæåÂèØ‰ª•ÂéªÁé©ÊôÇÈñìÂΩàÊÄßÁöÑ„ÄåÂ§ßÁôΩÈØä„ÄçÊàñ„Äå‰æèÈÇèÁ¥ÄÂÖ¨Âúí„Éª‰πòËàπÈÅä„Äç„ÄÇ", "transport": "ÂúíÂçÄÂÖßÊ≠•Ë°å„ÄÇ", "mapLink": "https://www.google.com/maps/search/?api=1&query=Universal+Studios+Japan"}, {"time": "14:40 - 15:30", "title": "Express Pass: ÂìàÂà©Ê≥¢ÁâπÁöÑÈ≠îÊ≥ï‰∏ñÁïå‚Ñ¢", "description": "Ê†πÊìöExpress PassÊôÇÈñìÊ∫ñÊôÇÈÄ≤ÂÖ•ÂúíÂçÄÔºÅÂú® 15:00-15:30 ÊúüÈñìÈ´îÈ©ó„ÄåÂìàÂà©Ê≥¢ÁâπÁ¶ÅÂøå‰πãÊóÖ‚Ñ¢„Äç„ÄÇ", "transport": "Âõ≠ÂçÄÂÖßÊ≠•Ë°å„ÄÇ", "mapLink": "https://www.google.com/maps/search/?api=1&query=The+Wizarding+World+of+Harry+Potter+Osaka"}, {"time": "ÂÇçÊôö (18:00 Âæå)", "title": "Halloween Horror Nights & „Çæ„É≥„Éì„Éª„Éá„Éª„ÉÄ„É≥„Çπ", "description": "ÂÖ•Â§úÂæåÔºåÊ∫ñÂÇôËøéÊé•Ëê¨ËÅñÁØÄÊÅêÊÄñ‰πãÂ§úÔºÅÂú®ÂúíÂçÄÂêÑËôïËàáÂñ™Â±ç‰∏çÊúüËÄåÈÅáÔºå‰∏¶Ê¨£Ë≥ûÁÜ±ÂäõÂõõÂ∞ÑÁöÑ„Äé„Çæ„É≥„Éì„Éª„Éá„Éª„ÉÄ„É≥„Çπ„Äè(Âñ™Â±çÁæ§Ëàû) Ë°®Êºî„ÄÇ", "transport": "ÂúíÂçÄÂÖßÊ≠•Ë°å„ÄÇ", "mapLink": "https://www.google.com/maps/search/?api=1&query=Universal+Studios+Japan"} ], "optionalActivities": [ {"title": "„Éê„Ç§„Ç™„Éè„Ç∂„Éº„Éâ‚Ñ¢ („Éè„É≠„Ç¶„Ç£„Éº„É≥)", "description": "È´îÈ©óËê¨ËÅñÁØÄÊúüÈñìÈôêÂÆöÁöÑÊÅêÊÄñËø∑ÂÆÆÔºåËàáÂñ™Â±çËøëË∑ùÈõ¢Êé•Ëß∏ÔºÅÊ¥ªÂãïÈÄöÂ∏∏Âú®ÂÇçÊôö6ÈªûÂæåÈñãÂßã„ÄÇ", "mapLink": "https://www.google.com/maps/search/?api=1&query=Universal+Studios+Japan"}, {"title": "Ëó•Â±ã„ÅÆ„Å≤„Å®„Çä„Åî„Å® „Éü„Çπ„ÉÜ„É™„Éº„Éª„Ç¶„Ç©„Éº„ÇØ", "description": "ÊúüÈñìÈôêÂÆöÂêà‰ΩúÔºÅÂåñË∫´Ëó•Â∏´ÔºåËàáË≤ìË≤ì‰∏ÄËµ∑Âú®ÂúíÂçÄÂÖßËß£ÈñãË¨éÈ°å„ÄÇ", "mapLink": "https://www.google.com/maps/search/?api=1&query=Universal+Studios+Japan"} ] },
                   { "day": 6, "date": "2025-09-18", "theme": "‰∫¨ÈÉΩÁ≤æËèØ‰∏ÄÊó•ÈÅä", "location": "Kyoto", "activities": [ {"time": "Áï∂Êó•‰ΩèÂÆø", "title": "Êù±Ê©´INN Â§ßÈò™Ê¢ÖÁî∞Êù±", "description": "ÊóÖÁ®ãÁ¨¨‰∏âËá≥ÂçÅÊó•ÁöÑ‰∏ãÊ¶ªÈÖíÂ∫ó„ÄÇ", "transport": "‰ΩçÊñºÊ¢ÖÁî∞Êù±Âú∞ÂçÄÔºåÈÑ∞ËøëÂú∞ÈêµÁ´ô„ÄÇ", "mapLink": "https://www.google.com/maps/search/?api=1&query=Toyoko+Inn+Osaka+Umeda+Higashi"}, {"time": "‰∏äÂçà", "title": "ÂâçÂæÄ‰∫¨ÈÉΩ & Ê∏ÖÊ∞¥ÂØ∫ÈÅì", "description": "ÂæûÈÖíÂ∫óÂá∫ÁôºÔºåÂâçÂæÄÊ∏ÖÊ∞¥ÂØ∫„ÄÇÂèÉÊãúÂÆåÂÆèÂÅâÂòÖÊ∏ÖÊ∞¥ËàûÂè∞ÂæåÔºåÊ≤ø‰ΩèÂÖÖÊªøÂè§ÈÉΩÈ¢®ÊÉÖÂòÖ‰∫åÂπ¥ÂùÇ„ÄÅ‰∏âÂπ¥ÂùÇÁü≥ÊùøË∑ØÊÖ¢ÊÖ¢Ë°åËêΩÂ±±„ÄÇ", "transport": "Áî±„ÄåÂ§ßÈò™/Ê¢ÖÁî∞Á´ô„ÄçÊê≠‰πò JR‰∫¨ÈÉΩÁ∑öÊñ∞Âø´ÈÄüÔºåÁ¥Ñ30ÂàÜÈêòÁõ¥ÈÅî„Äå‰∫¨ÈÉΩÁ´ô„ÄçÔºåÂÜçËΩâ‰πòÂ∑¥Â£´ÂâçÂæÄ (Á¥Ñ15ÂàÜÈêò)„ÄÇ", "mapLink": "https://www.google.com/maps/search/?api=1&query=Kiyomizu-dera+Temple"}, {"time": "‰∏≠Âçà", "title": "Á•áÂúí„ÉªËä±Ë¶ãÂ∞èË∑Ø", "description": "È†ÜË∑ØË°åÂà∞ÂÖ´ÂùÇÁ•ûÁ§æÔºåÁÑ∂ÂæåÈÄ≤ÂÖ•Á•áÂúíÂú∞ÂçÄ„ÄÇ‰Ω†ÂèØ‰ª•Âñ∫Ëä±Ë¶ãÂ∞èË∑ØÊÑüÂèóËóùÂ¶ìÊñáÂåñÂòÖÊ∞õÂúçÔºå‰∏¶Âñ∫ÈôÑËøëÊêµÈñìÈ§êÂª≥È£üÂçàÈ§ê„ÄÇ", "transport": "ÂæûÊ∏ÖÊ∞¥ÂØ∫Ê≠•Ë°åÂâçÂæÄ (Á¥Ñ20ÂàÜÈêò)„ÄÇ", "mapLink": "https://www.google.com/maps/search/?api=1&query=Gion+Hanamikoji"}, {"time": "ÂÇçÊôö", "title": "ËøîÂõûÂ§ßÈò™", "description": "Âú®‰∫¨ÈÉΩÈ£üÂÆåÊôöÈ£ØÔºåÊàñËÄÖËøîÂà∞Â§ßÈò™ÂÜçÈ£üÔºåÁÑ∂ÂæåËøîÈÖíÂ∫ó‰ºëÊÅØ„ÄÇ", "transport": "Âæû„ÄéËøëÈêµ‰∫¨ÈÉΩÁ´ô„ÄèÊê≠‰πòÊÄ•Ë°åÔºåÊñº„ÄéÂ§ßÂíåË•øÂ§ßÂØ∫„ÄèËΩâËªäÂæÄ„ÄéÂ§ßÈò™Èõ£Ê≥¢„Äè(Á∏ΩÁ®ãÁ¥Ñ50-60ÂàÜÈêòÔºåPassÈÅ©Áî®)„ÄÇ", "mapLink": "https://www.google.com/maps/search/?api=1&query=Kyoto+Station"} ], "optionalActivities": [ {"title": "Èå¶Â∏ÇÂ†¥", "description": "Â¶ÇÊûúÊôÇÈñìË®±ÂèØÔºåÂèØ‰ª•ÂéªÊÑüÂèó„Äå‰∫¨ÈÉΩÂòÖÂªöÊàø„ÄçÂòÖÁÜ±È¨ßÊ∞£Ê∞õÔºåÈ£ü‰∏ãÂ∞èÈ£ü„ÄÇ", "mapLink": "https://www.google.com/maps/search/?api=1&query=Nishiki+Market"} ] },
                   { "day": 7, "date": "2025-09-19", "theme": "Áõ¥Â•îÁ•ûË©±‰πãÂúã", "location": "Ise", "activities": [ {"time": "‰∏äÂçà", "title": "ÂâçÂæÄ‰ºäÂã¢", "description": "Âú®Â§ßÈò™Ê¢ÖÁî∞ÈÖíÂ∫ó Check-outÔºåÂØÑÂ≠òÂ§ß‰ª∂Ë°åÊùé„ÄÇËºïË£ùÂâçÂæÄ„ÄåÂ§ßÈò™Èõ£Ê≥¢Á´ô„Äç„ÄÇ", "transport": "Áî® Pass ÊèõÈ†ò„ÄêÁ¨¨‰∏ÄÂºµÁâπÊÄ•Âà∏„ÄëÔºåÊê≠‰πòËøëÈêµÁâπÊÄ•Áõ¥ÈÅî„ÄåÂÆáÊ≤ªÂ±±Áî∞Á´ô„Äç(Á¥Ñ1Â∞èÊôÇ50ÂàÜÈêò)„ÄÇ", "mapLink": "https://www.google.com/maps/search/?api=1&query=Ujiyamada+Station"}, {"time": "‰∏ãÂçà", "title": "‰ºäÂã¢Á•ûÂÆÆÂèÉÊãú", "description": "ÂèÉÊãú‰ºäÂã¢Á•ûÂÆÆ (Â§ñÂÆÆÂèäÂÖßÂÆÆ)Ôºå‰∏¶Âñ∫„ÄåÊâòÁ¶èÊ©´‰∏Å„Äç‰∫´ÂèóÁæéÈ£ü„ÄÇ", "transport": "Êê≠‰πòÂ∑¥Â£´ÊàñÊ≠•Ë°å„ÄÇ", "mapLink": "https://www.google.com/maps/search/?api=1&query=Ise+Grand+Shrine"}, {"time": "Â§úÊôö", "title": "ÂÖ•‰Ωè: ‰ºäË≥Ä‰∏äÈáé„Ç∑„ÉÜ„Ç£„Éõ„ÉÜ„É´", "description": "Âæû‰ºäÂã¢Âá∫ÁôºÔºåÂâçÂæÄ‰ºäË≥Ä‰∏äÈáéÁöÑÈÖíÂ∫óËæ¶ÁêÜÂÖ•‰ΩèÔºåÁÇ∫ÊòéÊó•ÁöÑÂøçËÄÖ‰øÆË°åÂÅöÊ∫ñÂÇô„ÄÇ", "transport": "Âæû„ÄéÂÆáÊ≤ªÂ±±Áî∞Á´ô„ÄèÊê≠‰πòËøëÈêµÂà∞„Äé‰ºäË≥ÄÁ•ûÊà∏Á´ô„Äè(Á¥Ñ1Â∞èÊôÇ)ÔºåÂÜçËΩâ‰πò‰ºäË≥ÄÈêµÈÅìÂà∞„Äé‰∏äÈáéÂ∏ÇÁ´ô„Äè(Á¥Ñ25ÂàÜÈêò)„ÄÇ", "mapLink": "https://www.google.com/maps/search/?api=1&query=Iga+Ueno+City+Hotel"} ] },
                   { "day": 8, "date": "2025-09-20", "theme": "ÂøçËÄÖ‰øÆË°åËàáÊºîÂî±ÊúÉÁãÇÁÜ±", "location": "Nagoya", "activities": [ {"time": "Áï∂Êó•‰ΩèÂÆø", "title": "ÂêçÂè§Â±ãÂ∏ÇÂÖßÈÖíÂ∫ó (ÂæÖÂÆö)", "description": "Âú®ÂêçÂè§Â±ã‰Ωè‰∏ÄÊôöÔºåËºïÈ¨Ü‰∫´ÂèóÊºîÂî±ÊúÉÂæåÂòÖÈ§òÈüª„ÄÇ", "transport": "ÂêçÂè§Â±ãÂ∏ÇÂÖß‰∫§ÈÄö", "mapLink": "https://www.google.com/maps/search/?api=1&query=Nagoya"}, {"time": "‰∏äÂçà", "title": "‰ºäË≥Ä‰∏äÈáéÂüé & ÂøçËÄÖÂçöÁâ©È§®", "description": "Âú®ÈÖíÂ∫ó Check-out ÂæåÔºåÂ∞áË°åÊùéÂØÑÂ≠òÂú®ËªäÁ´ôÂÑ≤Áâ©Ê´É„ÄÇÁÑ∂ÂæåÂèÉËßÄ‰ºäË≥Ä‰∏äÈáéÂüéÂèäÊóÅÈÇäÁöÑ‰ºäË≥ÄÊµÅÂøçËÄÖÂçöÁâ©È§®„ÄÇ", "transport": "Ê≠•Ë°å", "mapLink": "https://www.google.com/maps/search/?api=1&query=Iga+Ueno+Castle"}, {"time": "‰∏ãÂçà", "title": "ÂâçÂæÄÂêçÂè§Â±ã", "description": "Áî±„Äå‰ºäË≥ÄÁ•ûÊà∏Á´ô„ÄçÊèõÈ†ò„ÄêÁ¨¨‰∫åÂºµÁâπÊÄ•Âà∏„ÄëÔºåÊê≠‰πòËøëÈêµÁâπÊÄ•Áõ¥ÈÅî„ÄåËøëÈêµÂêçÂè§Â±ãÁ´ô„Äç(Á¥Ñ1Â∞èÊôÇ10ÂàÜÈêò)„ÄÇ", "transport": "ËøëÈêµÁâπÊÄ•„ÄÇ", "mapLink": "https://www.google.com/maps/search/?api=1&query=Kintetsu+Nagoya+Station"}, {"time": "18:00", "title": "Yorushika LIVE TOUR 2025„ÄåÁõó‰Ωú ÂÜçÊºî„Äç", "description": "16:30 ÈñãÂ†¥Ôºå18:00 ÈñãÊºî„ÄÇÊ∫ñÂÇôÂÖ•Â†¥ÔºåÊ¨£Ë≥û Yorushika „ÅÆÁ≤æÂΩ©ÊºîÂá∫ÔºÅ", "transport": "Êê≠‰πòÂêçÂè§Â±ãÂ∏ÇÂÖß‰∫§ÈÄö„ÄÇ", "mapLink": "https://www.google.com/maps/search/?api=1&query=IG+Arena+Nagoya"} ] },
                   { "day": 9, "date": "2025-09-21", "theme": "Ê∞¥ÈÉΩ„Åè„Çâ„Çè„Çì„ÅãËä±ÁÅ´Â§ß‰ºö", "location": "Osaka", "notes": ["Ê≥®ÊÑèÔºöËä±ÁÅ´Â§ßÊúÉÁöÑÁ¢∫ÂàáËàâËæ¶Êó•ÊúüÂíåÊôÇÈñìÔºåË´ãÂú®Âá∫ÁôºÂâçÂÜçÊ¨°Âà∞ÂÆòÊñπÁ∂≤Á´ôÁ¢∫Ë™ç„ÄÇ"], "activities": [ {"time": "Áï∂Êó•‰ΩèÂÆø", "title": "Êù±Ê©´INN Â§ßÈò™Ê¢ÖÁî∞Êù±", "description": "ÊóÖÁ®ãÁ¨¨‰∏âËá≥ÂçÅÊó•ÁöÑ‰∏ãÊ¶ªÈÖíÂ∫ó„ÄÇ", "transport": "‰ΩçÊñºÊ¢ÖÁî∞Êù±Âú∞ÂçÄÔºåÈÑ∞ËøëÂú∞ÈêµÁ´ô„ÄÇ", "mapLink": "https://www.google.com/maps/search/?api=1&query=Toyoko+Inn+Osaka+Umeda+Higashi"}, {"time": "‰∏≠Âçà", "title": "ËøîÂõûÂ§ßÈò™", "description": "Âú®ÂêçÂè§Â±ãÊÇ†ÈñíÊ∏°ÈÅé‰∏äÂçàÂæå Check-out„ÄÇÊèõÈ†ò„ÄêÁ¨¨‰∏âÂºµÁâπÊÄ•Âà∏„ÄëÔºåÊê≠‰πòË±™ËèØÁâπÊÄ•„Äå„Å≤„ÅÆ„Å®„Çä (Hinotori)„ÄçËøîÂõû„ÄåÂ§ßÈò™Èõ£Ê≥¢Á´ô„Äç(Á¥Ñ2Â∞èÊôÇ)„ÄÇ", "transport": "ËøëÈêµË±™ËèØÁâπÊÄ• „Å≤„ÅÆ„Å®„Çä„ÄÇ", "mapLink": "https://www.google.com/maps/search/?api=1&query=Osaka-Namba+Station"}, {"time": "‰∏ãÂçà", "title": "ËøîÂõûÊ¢ÖÁî∞ÈÖíÂ∫ó", "description": "ËøîÂà∞Ê¢ÖÁî∞ÂòÖÂéüÈÖíÂ∫óÊîûËøîË°åÊùé‰∏¶ Check-inÔºåÁ®ç‰Ωú‰ºëÊÅØ„ÄÇ", "transport": "Âæû„ÄéÈõ£Ê≥¢Á´ô„ÄèÊê≠‰πòÂæ°Â†ÇÁ≠ãÁ∑öÂà∞„ÄéÊ¢ÖÁî∞Á´ô„Äè(Á¥Ñ8ÂàÜÈêò)„ÄÇ", "mapLink": "https://www.google.com/maps/search/?api=1&query=Toyoko+Inn+Osaka+Umeda+Higashi"}, {"time": "ÂÇçÊôö", "title": "Ê∞¥ÈÉΩ„Åè„Çâ„Çè„Çì„ÅãËä±ÁÅ´Â§ß‰ºö", "description": "ÂâçÂæÄÊ∑ÄÂ∑ùÊ≤≥Â∑ùÂÖ¨ÂúíÔºåÊ¨£Ë≥ûÂú®Ê≤≥Â≤∏Á∂ªÊîæÁöÑÁõõÂ§ßÁÖôËä±ÔºåÁÇ∫ÊóÖÁ®ãÂ¢ûÊ∑ªÊµ™Êº´ÂõûÊÜ∂„ÄÇ", "transport": "Âæû JR„ÄéÂ§ßÈò™Á´ô„ÄèÊê≠‰πòJR‰∫¨ÈÉΩÁ∑öÂà∞„ÄéÈ´òÊßªÁ´ô„Äè(Á¥Ñ15ÂàÜÈêò)ÂæåÊ≠•Ë°å„ÄÇ", "mapLink": "https://www.google.com/maps/search/?api=1&query=Yodogawa+Kasen+Park+Hirakata"} ] },
                   { "day": 10, "date": "2025-09-22", "theme": "Â§ßÈò™ÊúÄÂæåÂ∑°Á¶Æ & Ê≠∏ÈÄî", "location": "Osaka", "activities": [ {"time": "‰∏äÂçà", "title": "ÊúÄÂæåÊé°Ë≥º", "description": "Âú®Ê¢ÖÁî∞Âú∞ÂçÄÈÄ≤Ë°åÊúÄÂæåÁöÑË≥ºÁâ©ÔºåË≥ºË≤∑Êâã‰ø°ÊàñË£úË≤®„ÄÇ", "transport": "Ê≠•Ë°åÊàñÊê≠‰πòÂú∞Èêµ„ÄÇ", "mapLink": "https://www.google.com/maps/search/?api=1&query=Umeda+Station"}, {"time": "‰∏≠Âçà", "title": "ÈÄÄÊàøËàáÂØÑÂ≠òË°åÊùé", "description": "ËøîÂõûÈÖíÂ∫óËæ¶ÁêÜÈÄÄÊàøÊâãÁ∫åÔºå‰∏¶Â∞áË°åÊùéÂØÑÂ≠òÂú®ÈÖíÂ∫ó„ÄÇ", "transport": "Ê≠•Ë°å", "mapLink": "https://www.google.com/maps/search/?api=1&query=Toyoko+Inn+Osaka+Umeda+Higashi"}, {"time": "‰∏ãÂçà", "title": "ÊÇ†Èñí‰∏ãÂçàËå∂", "description": "Âú®Ê¢ÖÁî∞Êâæ‰∏ÄÂÆ∂ÂíñÂï°Âª≥ÔºåÊÇ†ÈñíÂú∞Â∫¶ÈÅé‰∏äÊ©üÂâçÁöÑÊúÄÂæåÊôÇÂÖâ„ÄÇ", "transport": "Ê≠•Ë°å", "mapLink": "https://www.google.com/maps/search/?api=1&query=Umeda+cafe"}, {"time": "17:30", "title": "È†òÂèñË°åÊùé & ÂâçÂæÄÊ©üÂ†¥ (MM067)", "description": "Ëà™Áè≠ MM067 Êñº 20:40 Ëµ∑È£õ„ÄÇÂª∫Ë≠∞ÊúÄÈÅ≤Êñº 17:30 È†òÂèñË°åÊùéÂæåÂá∫ÁôºÔºåÁõÆÊ®ôÂú® 18:10 ÂâçÂà∞ÈÅîÊ©üÂ†¥Â∑¥Â£´Á´ô„ÄÇ", "transport": "ÂæûÊ¢ÖÁî∞Âú∞ÂçÄÊê≠‰πòÊ©üÂ†¥Â∑¥Â£´ (Airport Limousine Bus) ÊòØÊúÄÊñπ‰æøÁöÑÈÅ∏Êìá (Á¥Ñ60ÂàÜÈêò)„ÄÇ", "mapLink": "https://www.google.com/maps/search/?api=1&query=Kansai+International+Airport"} ] }
              ],
              "foodieList": [
                  { "name": "Á•ûÂ∫ßÊãâÈ∫µ („Å©„ÅÜ„Å®„Çì„Åº„ÇäÁ•ûÂ∫ß)", "region": "Èõ£Ê≥¢", "tag": "ÊãâÈ∫µ", "mapLink": "https://www.google.com/maps/search/?api=1&query=Dotonbori+Kamukura+Ramen" },
                  { "name": "PABLO ËäùÂ£´Êíª", "region": "Èõ£Ê≥¢", "tag": "ÁîúÂìÅ", "mapLink": "https://www.google.com/maps/search/?api=1&query=PABLO+Cheesetart+Namba" },
                  { "name": "ÁáíËÇâ M Ê≥ïÂñÑÂØ∫Ê©´‰∏ÅÁ∏ΩÂ∫ó", "region": "Èõ£Ê≥¢", "tag": "ÁáíËÇâ", "mapLink": "https://www.google.com/maps/search/?api=1&query=Yakiniku+M+Hozenji+Yokocho" },
                  { "name": "„Åç„Åò Â§ßÈò™Ááí", "region": "Ê¢ÖÁî∞", "tag": "Â§ßÈò™Ááí", "mapLink": "https://www.google.com/maps/search/?api=1&query=Okonomiyaki+Kiji+Umeda" },
                  { "name": "HARBS Ê∞¥ÊûúÂçÉÂ±§ËõãÁ≥ï", "region": "Ê¢ÖÁî∞", "tag": "ÁîúÂìÅ", "mapLink": "https://www.google.com/maps/search/?api=1&query=HARBS+Daimaru+Umeda" },
                  { "name": "Ëå∂ÂØÆÈÉΩË∑ØÈáå Á•áÂúíÊú¨Â∫ó", "region": "‰∫¨ÈÉΩ", "tag": "ÁîúÂìÅ", "mapLink": "https://www.google.com/maps/search/?api=1&query=Saryo+Tsujiri+Gion+Main+Store" },
                  { "name": "„Åæ„Åô„Åü„Å´ÊãâÈ∫µ", "region": "‰∫¨ÈÉΩ", "tag": "ÊãâÈ∫µ", "mapLink": "https://www.google.com/maps/search/?api=1&query=Masutani+Ramen+Kyoto" },
                  { "name": "Áü¢Â†¥„Å®„Çì Âë≥ÂôåË±¨Êéí", "region": "ÂêçÂè§Â±ã", "tag": "Ë±¨Êéí", "mapLink": "https://www.google.com/maps/search/?api=1&query=Yabaton+Yaba-cho+Head+Office" },
                  { "name": "Cafe Tanaka", "region": "ÂêçÂè§Â±ã", "tag": "ÁîúÂìÅ", "mapLink": "https://www.google.com/maps/search/?api=1&query=Cafe+Tanaka+Nagoya" }
              ],
              "coupons": [
                  // ... Coupon data remains the same ...
                  { "name": "Bic Camera", "discount": "ÊªøÈ°çÂÖçÁ®ÖÔºåÊúÄÈ´òÂÜçÊäò7%", "expiry": "2025/8/31", "link": "https://funtime.tw/c/blog-68172-1", "final_url": "https://www.funtime.com.tw/travelstore/coupon/BicCamera_vertical.jpg", "category": "ÈõªÂô®" }, { "name": "Salonia", "discount": "Êäò5%(ÈúÄËàáBic CameraÂÑ™ÊÉ†Âà∏‰∏ÄËµ∑‰ΩøÁî®)", "expiry": "2025/8/31", "link": "https://funtime.tw/c/blog-68172-19", "final_url": "https://www.funtime.com.tw/travelstore/coupon/Salonia_250415.jpg?ftfrom=blog-68172-19", "category": "ÈõªÂô®" }, { "name": "ÊÑõÈõªÁéãEdion", "discount": "ÊªøÈ°çÂÖçÁ®ÖÔºåÊúÄÈ´òÂÜçÊäò7%", "expiry": "2026/12/31", "link": "https://funtime.tw/c/blog-68172-10", "final_url": "https://www.funtime.com.tw/travelstore/coupon/edion2025.jpg", "category": "ÈõªÂô®" }, { "name": "Laox", "discount": "ÊªøÈ°çÂÖçÁ®ÖÔºåÂÜçÊäò8%", "expiry": "2025/12/31", "link": "https://funtime.tw/c/blog-68172-15", "final_url": "https://www.funtime.com.tw/travelstore/coupon/LAOX_2025.jpg", "category": "ÈõªÂô®" }, { "name": "SUNDRUG", "discount": "ÊªøÈ°çÂÖçÁ®ÖÔºåÂÜç‰∫´3~7%ÊäòÊâ£", "expiry": "ÁÑ°ÊúüÈôê", "link": "https://funtime.tw/c/b2s50T", "final_url": "https://www.funtime.com.tw/travelstore/coupon/sundrug%20_funtime.jpg", "category": "Ëó•Â¶ù" }, { "name": "È∂¥ÁæΩËó•Â¶ù", "discount": "ÊªøÈ°çÂÖçÁ®ÖÔºåÊúÄÈ´ò‰∫´ÂÖçÁ®Ö+7%ÂÑ™ÊÉ†", "expiry": "2025/12/31", "link": "https://funtime.tw/c/blog-68172-11", "final_url": "https://www.funtime.com.tw/travelstore/coupon/tsuruha2025.jpg", "category": "Ëó•Â¶ù" }, { "name": "Êú≠ÂπåËó•Â¶ù", "discount": "ÊªøÈ°çÂÖçÁ®ÖÔºåÊúÄÈ´ò‰∫´ÂÖçÁ®Ö+5%ÂÑ™ÊÉ†", "expiry": "ÁÑ°ÊúüÈôê", "link": "https://funtime.tw/c/blog-68172-13", "final_url": "https://www.funtime.com.tw/travelstore/coupon/sapporo.jpg", "category": "Ëó•Â¶ù" }, { "name": "Cosmos", "discount": "ÊªøÈ°çÂÖçÁ®ÖÔºåÊúÄÈ´ò‰∫´ÂÖçÁ®Ö+9%ÂÑ™ÊÉ†", "expiry": "2025/12/31", "link": "https://funtime.tw/c/DsrcXF", "final_url": "https://www.funtime.com.tw/travelstore/coupon/cosmos2025.jpg", "category": "Ëó•Â¶ù" }, { "name": "ËøëÈêµÁôæË≤®Â∫ó", "discount": "Êªø2ÂçÉÊó•Âúì(‰∏çÂê´Á®Ö)ÔºåÂèØ‰∫´Êúâ95ÊäòÂÑ™ÊÉ†", "expiry": "2025/12/31", "link": "https://funtime.tw/c/blog-68172-14", "final_url": "https://www.funtime.com.tw/travelstore/coupon/kintetsu2025.png", "category": "ÁôæË≤®", "region": "ÈóúË•ø" }, { "name": "Â§ß‰∏∏ÊùæÂùÇÂ±ã", "discount": "ÂñÆÁ≠ÜÊ∂àË≤ªÂê´Á®ÖÊªø3ÂçÉÊó•ÂúìÔºå‰∫´95Êäò", "expiry": "2025/8/31", "link": "https://funtime.tw/c/blog-68172-6", "final_url": "https://www.funtime.com.tw/travelstore/coupon/daimaru_2.pdf", "category": "ÁôæË≤®" }, { "name": "Ë•øÊ≠¶ÁôæË≤®", "discount": "Ê∂àË≤ªÊªø1ÂçÉÊó•ÂúìÔºå‰∫´95Êäò", "expiry": "2025/12/31", "link": "https://funtime.tw/c/blog-68172-2", "final_url": "https://www.funtime.com.tw/travelstore/coupon/seibu2025.png", "category": "ÁôæË≤®" }, { "name": "ÂêçÂè§Â±ãÂêçÈêµÁôæË≤®Â∫ó", "discount": "ÂÖçÁ®ÖÂÜçÊäò5%", "expiry": "2026/2/28", "link": "https://funtime.tw/c/blog-68172-18", "final_url": "https://www.funtime.com.tw/travelstore/coupon/meitetsu_250516.png", "category": "ÁôæË≤®", "region": "ÂêçÂè§Â±ã" }, { "name": "‰∫¨ÁéãÁôæË≤®", "discount": "ÂñÆÁ≠ÜÊ∂àË≤ªÊªø3ÂçÉÊó•ÂúìÔºå‰∫´95Êäò", "expiry": "2026/03/31", "link": "https://funtime.tw/c/blog-68172-3", "final_url": "https://www.funtime.com.tw/travelstore/coupon/Keio_2.jpeg", "category": "ÁôæË≤®", "region": "Êù±‰∫¨" }, { "name": "Â∞èÁî∞ÊÄ•ÁôæË≤®", "discount": "Ê∂àË≤ªÊªø1ÂçÉÊó•Âúì(Âê´Á®Ö)ÔºåÂèØ‰∫´6%ÂÑ™ÊÉ†", "expiry": "2028/3/31", "link": "https://funtime.tw/c/blog-68172-12", "final_url": "https://www.funtime.com.tw/travelstore/coupon/odakyu.png", "category": "ÁôæË≤®", "region": "Êù±‰∫¨" }, { "name": "DonkiÂîêÂêâË®∂Âæ∑", "discount": "ÊªøÈ°çÂÖçÁ®ÖÔºåÂÜçÊäò5%", "expiry": "ÁÑ°ÊúüÈôê", "link": "https://funtime.tw/c/blog-68172-9", "final_url": "https://japanportal.donki-global.com/coupon/?ptcd=0076003303", "category": "Á∂úÂêà/ÂÖçÁ®Ö" }, { "name": "ÈäÄÂ∫ßÊ®ÇÂ§©ÂÖçÁ®ÖÂ∫ó", "discount": "Êªø1Ëê¨Êó•ÂúìÊäò1ÂçÉÔºåÊªø2Ëê¨Êäò2ÂçÉ", "expiry": "2026/1/31", "link": "https://funtime.tw/c/blog-68172-7", "final_url": "https://www.funtime.com.tw/travelstore/coupon/Lottedutyfree_GINZA_FunTime2025.jpg", "category": "Á∂úÂêà/ÂÖçÁ®Ö", "region": "Êù±‰∫¨" }, { "name": "ÊàêÁî∞Ê©üÂ†¥ÂÖçÁ®ÖÂ∫ó", "discount": "‰∫´Êúâ95ÊäòÂÑ™ÊÉ†", "expiry": "2026/3/31", "link": "https://funtime.tw/c/blog-68172-16", "final_url": "https://duty-free-japan.jp/narita/ta/content/coupon2833-30.html", "category": "Á∂úÂêà/ÂÖçÁ®Ö", "region": "Êù±‰∫¨" }, { "name": "ÊàêÁî∞/ÁæΩÁî∞Ê©üÂ†¥ ÂÖçÁ®ÖÂïÜÂìÅÁ∑ö‰∏äË®Ç", "discount": "‰∫´Êúâ95ÊäòÂÑ™ÊÉ†", "expiry": "ÁÑ°ÊúüÈôê", "link": "https://funtime.tw/c/blog-68172-17", "final_url": "https://duty-free-japan.jp/qrposter/tc/?agentid=123", "category": "Á∂úÂêà/ÂÖçÁ®Ö", "region": "Êù±‰∫¨" }, { "name": "VictoriaÈÅãÂãïÁî®ÂìÅ", "discount": "ÂÖçÁ®ÖÂÜçÊäò5%", "expiry": "2026/6/30", "link": "https://funtime.tw/c/blog-68172-8", "final_url": "https://www.funtime.com.tw/travelstore/coupon/FunTime_Victoria_202606.jpg", "category": "ÂÖ∂‰ªñ" }
              ]
            };

            // --- DOM Elements ---
            const mainPageWrapper = document.getElementById('main-page-wrapper');
            const detailPage = document.getElementById('detail-page');
            const mainTitle = document.getElementById('main-title');
            const itineraryView = document.getElementById('itinerary-view');
            const foodieView = document.getElementById('foodie-view');
            const couponView = document.getElementById('coupon-view');
            const detailHeader = document.getElementById('detail-header');
            const detailContent = document.getElementById('detail-content');
            const navContainer = document.getElementById('nav-container');
            const couponModal = document.getElementById('coupon-modal');
            const couponModalContent = document.getElementById('coupon-modal-content');
            
            // --- Helper Functions ---
            function formatDate(dateString) {
                const date = new Date(dateString);
                date.setMinutes(date.getMinutes() + date.getTimezoneOffset());
                const month = date.getMonth() + 1;
                const dayOfMonth = date.getDate();
                const weekday = ["ÊòüÊúüÊó•", "ÊòüÊúü‰∏Ä", "ÊòüÊúü‰∫å", "ÊòüÊúü‰∏â", "ÊòüÊúüÂõõ", "ÊòüÊúü‰∫î", "ÊòüÊúüÂÖ≠"][date.getDay()];
                return `(${String(month).padStart(2, '0')}Êúà${String(dayOfMonth).padStart(2, '0')}Êó•, ${weekday})`;
            }

            function getWeatherIcon(code) {
                if ([0, 1].includes(code)) return '‚òÄÔ∏è';
                if ([2].includes(code)) return '‚õÖÔ∏è';
                if ([3].includes(code)) return '‚òÅÔ∏è';
                if ([45, 48].includes(code)) return 'üå´Ô∏è';
                if ([51, 53, 55, 61, 63, 65, 80, 81, 82].includes(code)) return 'üåßÔ∏è';
                if ([71, 73, 75, 77, 85, 86].includes(code)) return '‚ùÑÔ∏è';
                if ([95, 96, 99].includes(code)) return '‚õàÔ∏è';
                return 'üå°Ô∏è';
            }
            
            const delay = ms => new Promise(res => setTimeout(res, ms));

            async function fetchAllWeatherData(locations, itinerary) {
                const weatherByLocation = {};
                const startDate = itinerary[0].date;
                const endDate = itinerary[itinerary.length - 1].date;
                const today = new Date('2025-07-19T16:55:00+09:00'); // Using user-provided time
                const tripStartDate = new Date(startDate);
                const diffTime = tripStartDate - today;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

                let apiType = 'forecast';
                let queryStartDate = startDate;
                let queryEndDate = endDate;

                if (diffDays > 16) {
                    apiType = 'historical';
                    const start = new Date(startDate);
                    start.setFullYear(start.getFullYear() - 1);
                    queryStartDate = start.toISOString().split('T')[0];
                    
                    const end = new Date(endDate);
                    end.setFullYear(end.getFullYear() - 1);
                    queryEndDate = end.toISOString().split('T')[0];
                }

                for (const [name, coords] of Object.entries(locations)) {
                    let url = '';
                    if (apiType === 'forecast') {
                        url = `https://api.open-meteo.com/v1/forecast?latitude=${coords.lat}&longitude=${coords.lon}&daily=weathercode,temperature_2m_max,temperature_2m_min&timezone=Asia%2FTokyo&forecast_days=16`;
                    } else {
                        url = `https://archive-api.open-meteo.com/v1/archive?latitude=${coords.lat}&longitude=${coords.lon}&start_date=${queryStartDate}&end_date=${queryEndDate}&daily=weathercode,temperature_2m_max,temperature_2m_min&timezone=Asia%2FTokyo`;
                    }
                    
                    try {
                        const response = await fetch(url);
                        if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                        const data = await response.json();
                        weatherByLocation[name] = { type: apiType, daily: data.daily };
                    } catch (error) {
                        console.error(`Failed to fetch weather for ${name}:`, error);
                        weatherByLocation[name] = null;
                    }
                    await delay(250); // Wait 250ms before the next request
                }
                return weatherByLocation;
            }

            // --- Render Functions ---

            function renderFoodieList() {
                foodieView.innerHTML = ''; // Clear previous content
                
                // --- Gemini AI Feature ---
                const aiContainer = document.createElement('div');
                aiContainer.id = 'ai-foodie-container';
                aiContainer.innerHTML = `
                    <button id="get-ai-suggestions" class="w-full flex items-center justify-center gap-2 px-4 py-3 bg-indigo-600 text-white font-bold rounded-lg hover:bg-indigo-700 transition-colors shadow-lg">
                        ${getIconSvg('sparkles', { classes: 'w-5 h-5' })}
                        ‚ú® AI ÁæéÈ£üÂª∫Ë≠∞
                    </button>
                    <div id="ai-suggestions-loader" class="hidden mt-4 flex justify-center"><div class="gemini-loader"></div></div>
                    <div id="ai-suggestions-error" class="hidden mt-4 text-red-500 text-center"></div>
                    <div id="ai-suggestions-results" class="space-y-3"></div> 
                `;
                foodieView.appendChild(aiContainer);
                
                // Group food items by region
                const groupedFood = tripData.foodieList.reduce((acc, item) => {
                    const region = item.region;
                    if (!acc[region]) {
                        acc[region] = [];
                    }
                    acc[region].push(item);
                    return acc;
                }, {});

                const regionOrder = ['Èõ£Ê≥¢', 'Ê¢ÖÁî∞', '‰∫¨ÈÉΩ', 'ÂêçÂè§Â±ã'];

                regionOrder.forEach(region => {
                    if (groupedFood[region]) {
                        const items = groupedFood[region];
                        
                        const regionWrapper = document.createElement('div');

                        const titleEl = document.createElement('h3');
                        titleEl.className = "text-xl font-bold text-gray-100 mb-4 border-b pb-2 border-gray-700";
                        titleEl.textContent = region;
                        regionWrapper.appendChild(titleEl);

                        const listContainer = document.createElement('div');
                        listContainer.className = "space-y-3";
                        
                        items.forEach(item => {
                            listContainer.appendChild(createFoodieCard(item));
                        });
                        regionWrapper.appendChild(listContainer);
                        foodieView.appendChild(regionWrapper);
                    }
                });
            }
            
            function createFoodieCard(item, isAi = false) {
                const card = document.createElement('div');
                card.className = `flex items-center justify-between bg-gray-800 p-4 rounded-xl border border-gray-700 shadow-sm`;

                card.innerHTML = `
                    <div class="flex-grow pr-4">
                        <div class="flex items-baseline gap-3 flex-wrap">
                            <h4 class="font-bold text-gray-200 text-lg">${item.name}</h4>
                            <span class="text-xs font-semibold inline-block py-1 px-2 uppercase rounded-full text-blue-200 bg-blue-900">
                                ${item.tag}
                            </span>
                            ${isAi ? '<span class="text-xs font-bold text-indigo-300 bg-indigo-900 px-2 py-0.5 rounded-full">AI</span>' : ''}
                        </div>
                    </div>
                    <a href="${item.mapLink}" target="_blank" class="flex-shrink-0 w-12 h-12 flex items-center justify-center rounded-full bg-gray-700 hover:bg-gray-600 transition-colors">
                        ${getIconSvg('map-pin', { classes: 'w-6 h-6 text-gray-300' })}
                    </a>
                `;
                return card;
            }

            function renderItinerary(weatherData) {
                itineraryView.innerHTML = '';
                const todayString = '2025-07-19';
                let isHistorical = false;

                tripData.itinerary.forEach((day, index) => {
                    const card = document.createElement('div');
                    const isCurrentDay = day.date === todayString;

                    card.className = isCurrentDay 
                        ? 'bg-blue-900/50 border-2 border-blue-400 p-5 rounded-xl shadow-lg transition-all cursor-pointer ring-4 ring-blue-500/50'
                        : 'bg-gray-700/50 p-5 rounded-xl shadow-sm hover:shadow-md hover:bg-gray-700 transition-all cursor-pointer';
                    
                    card.dataset.dayIndex = index;
                    
                    let weatherHtml = `<div id="weather-day-${index}" class="w-12 h-10 flex items-center justify-center"><div class="loader-small"></div></div>`; 
                    
                    let noteIcon = '';
                    if (day.notes && day.notes.length > 0) {
                        noteIcon = getIconSvg('bell-ring', { classes: 'w-4 h-4 text-amber-600' });
                    }
                    card.innerHTML = `
                        <div class="flex justify-between items-start">
                           <div class="flex-grow">
                                <div class="flex items-baseline gap-2">
                                    <p class="text-sm font-semibold text-blue-400">Day ${day.day}</p>
                                    <p class="text-xs text-gray-400">${formatDate(day.date)}</p>
                                    ${noteIcon}
                                </div>
                                <h3 class="text-lg font-bold text-gray-100 mt-1">${day.theme}</h3>
                           </div>
                           ${weatherHtml}
                        </div>
                    `;
                    itineraryView.appendChild(card);
                });
                
                // This will be populated later by updateWeatherUI
                const historicalNoteContainer = document.createElement('div');
                historicalNoteContainer.id = 'historical-note-container';
                itineraryView.appendChild(historicalNoteContainer);
            }
            
            // (NEW) This function updates the weather UI after the data is fetched.
            function updateWeatherUI(weatherByLocation) {
                let isHistorical = false;
                tripData.itinerary.forEach((day, index) => {
                    const weatherEl = document.getElementById(`weather-day-${index}`);
                    if (!weatherEl) return;

                    const locationWeatherData = weatherByLocation[day.location];
                    if(locationWeatherData) {
                        if(locationWeatherData.type === 'historical') isHistorical = true;
                        const dailyData = locationWeatherData.daily;
                        if (dailyData && dailyData.time) {
                            const weatherIndex = dailyData.time.findIndex(t => t.includes(day.date.substring(5)));
                            if (weatherIndex !== -1) {
                                const icon = getWeatherIcon(dailyData.weathercode[weatherIndex]);
                                const maxTemp = Math.round(dailyData.temperature_2m_max[weatherIndex]);
                                const minTemp = Math.round(dailyData.temperature_2m_min[weatherIndex]);
                                weatherEl.innerHTML = `<div class="text-right"><div class="text-2xl">${icon}</div><div class="text-xs text-gray-400">${minTemp}¬∞/${maxTemp}¬∞ ${locationWeatherData.type === 'historical' ? '*' : ''}</div></div>`;
                            } else {
                                weatherEl.innerHTML = `<div>-</div>`;
                            }
                        } else {
                             weatherEl.innerHTML = `<div>-</div>`;
                        }
                    } else {
                        weatherEl.innerHTML = `<div>-</div>`;
                    }
                });

                const historicalNoteContainer = document.getElementById('historical-note-container');
                if(isHistorical && historicalNoteContainer){
                    historicalNoteContainer.innerHTML = `<p class="text-xs text-center text-gray-500 mt-4">* Â§©Ê∞£Ë≥áË®äÁÇ∫ÂéªÂπ¥ÂêåÊúüÊï∏ÊìöÔºåÂÉÖ‰æõÂèÉËÄÉ„ÄÇ</p>`;
                }
            }


            function renderDetailPage(dayIndex, weatherByLocation) {
                const dayData = tripData.itinerary[dayIndex];
                
                detailHeader.innerHTML = `
                    <button id="back-button" class="p-2 rounded-full hover:bg-gray-700">
                        ${getIconSvg('arrow-left', { classes: 'w-6 h-6 text-gray-300' })}
                    </button>
                    <h2 class="text-lg font-bold text-center text-gray-100 flex-grow truncate px-2">Day ${dayData.day} ${formatDate(dayData.date)}</h2>
                `;

                let contentHtml = '<div class="p-6">';
                
                const locationWeatherData = weatherByLocation[dayData.location];
                 if (locationWeatherData) {
                    const dailyData = locationWeatherData.daily;
                    if (dailyData && dailyData.time) {
                        const weatherIndex = dailyData.time.findIndex(t => t.includes(dayData.date.substring(5)));
                        if (weatherIndex !== -1) {
                            const icon = getWeatherIcon(dailyData.weathercode[weatherIndex]);
                            const maxTemp = Math.round(dailyData.temperature_2m_max[weatherIndex]);
                            const minTemp = Math.round(dailyData.temperature_2m_min[weatherIndex]);
                            contentHtml += `
                                <div class="mb-6 p-4 bg-blue-900/30 rounded-lg flex items-center gap-4">
                                    <div class="text-4xl">${icon}</div>
                                    <div class="flex-grow">
                                        <p class="font-bold text-lg text-gray-100">${minTemp}¬∞C / ${maxTemp}¬∞C</p>
                                        <p class="text-sm text-blue-300">${dayData.location} Â§©Ê∞£È†êÂ†± ${locationWeatherData.type === 'historical' ? '(ÂéªÂπ¥ÂêåÊúü)' : ''}</p>
                                    </div>
                                </div>
                            `;
                        }
                    }
                }

                if (dayData.notes && dayData.notes.length > 0) {
                    contentHtml += '<div class="mb-6 space-y-2">';
                    dayData.notes.forEach(note => {
                        contentHtml += `
                            <div class="bg-yellow-900/30 border-l-4 border-yellow-400 text-yellow-300 p-4 rounded-r-lg flex items-start gap-3">
                                <div>${getIconSvg('alert-triangle', { classes: 'w-5 h-5' })}</div>
                                <p class="text-sm">${note}</p>
                            </div>
                        `;
                    });
                    contentHtml += '</div>';
                }

                dayData.activities.forEach(activity => {
                    contentHtml += `
                        <div class="timeline-item relative pl-10 pb-14">
                            <div class="absolute left-0 flex items-center justify-center w-10 h-10">
                                <div class="w-4 h-4 bg-blue-500 rounded-full border-4 border-gray-800"></div>
                            </div>
                            <p class="text-sm font-semibold text-gray-400 mb-1">${activity.time}</p>
                            <h4 class="font-bold text-lg text-gray-100">${activity.title}</h4>
                            <p class="text-gray-300 mt-1 mb-3">${activity.description}</p>
                            <a href="${activity.mapLink}" target="_blank" class="inline-flex items-center gap-2 text-sm text-blue-300 bg-blue-900/30 p-2 rounded-lg hover:bg-blue-900/50">
                                ${getIconSvg('tram-front', { classes: 'w-4 h-4' })}
                                <span>${activity.transport}</span>
                                ${getIconSvg('map-pin', { classes: 'w-4 h-4 ml-auto' })}
                            </a>
                        </div>
                    `;
                });
                
                if (dayData.optionalActivities && dayData.optionalActivities.length > 0) {
                    contentHtml += '<div class="mt-6 pt-6 border-t border-gray-700">';
                    contentHtml += `<h4 class="text-lg font-bold mb-4 text-gray-100">ÂΩàÊÄßÈÅ∏Êìá</h4><div class="space-y-4">`;
                    dayData.optionalActivities.forEach(optActivity => {
                        contentHtml += `
                            <a href="${optActivity.mapLink}" target="_blank" class="flex items-center gap-4 bg-gray-700/50 p-4 rounded-lg hover:bg-gray-700">
                                <div class="flex-grow">
                                    <h5 class="font-bold text-gray-200">${optActivity.title}</h5>
                                    <p class="text-sm text-gray-400 mt-1">${optActivity.description}</p>
                                </div>
                                ${getIconSvg('map-pin', { classes: 'w-5 h-5 text-gray-500 flex-shrink-0' })}
                            </a>
                        `;
                    });
                    contentHtml += `</div></div>`;
                }

                contentHtml += '</div>';
                detailContent.innerHTML = contentHtml;
            }
            
            function renderCoupons(){
                const couponContainer = document.getElementById('coupon-view');
                couponContainer.innerHTML = '';
                const groupedCoupons = tripData.coupons.reduce((acc, coupon) => {
                    if (!acc[coupon.category]) acc[coupon.category] = [];
                    acc[coupon.category].push(coupon);
                    return acc;
                }, {});

                const categoryOrder = ["ÈõªÂô®", "Ëó•Â¶ù", "ÁôæË≤®", "Á∂úÂêà/ÂÖçÁ®Ö", "ÂÖ∂‰ªñ"];
                const categoryIcons = { "ÈõªÂô®": "plug-zap", "Ëó•Â¶ù": "pilcrow", "ÁôæË≤®": "shopping-bag", "Á∂úÂêà/ÂÖçÁ®Ö": "gem", "ÂÖ∂‰ªñ": "shopping-cart" };

                categoryOrder.forEach(category => {
                    if (groupedCoupons[category]) {
                        const categoryTitle = document.createElement('h3');
                        categoryTitle.className = "text-lg font-bold text-gray-200 flex items-center gap-2";
                        categoryTitle.innerHTML = `${getIconSvg(categoryIcons[category], { classes: 'w-5 h-5' })} ${category}`;
                        couponContainer.appendChild(categoryTitle);

                        const gridContainer = document.createElement('div');
                        gridContainer.className = "grid grid-cols-1 md:grid-cols-2 gap-4 mt-2";
                        
                        groupedCoupons[category].forEach(coupon => {
                            const card = document.createElement('div');
                            card.className = 'bg-gray-700/50 border border-gray-700 rounded-xl overflow-hidden shadow-sm flex flex-col cursor-pointer coupon-card';
                            card.dataset.finalUrl = coupon.final_url;
                            
                            const isImageUrl = /\.(jpeg|jpg|gif|png|webp|pdf)(\?.*)?$/i.test(coupon.final_url);
                            const iconHtml = isImageUrl ? getIconSvg('image', { classes: 'w-4 h-4 text-gray-400' }) : getIconSvg('link-2', { classes: 'w-4 h-4 text-gray-400' });
                            
                            const regionTag = coupon.region ? `<span class="text-xs bg-green-900 text-green-200 px-2 py-0.5 rounded-full">${coupon.region}</span>` : '';

                            card.innerHTML = `
                                <div class="p-4 flex-grow flex flex-col pointer-events-none">
                                    <div class="flex items-center gap-2 mb-1">
                                       <h3 class="font-bold text-lg text-gray-200">${coupon.name}</h3>
                                    </div>
                                    <p class="text-sm text-gray-400 mt-1 flex-grow">${coupon.discount}</p>
                                    <div class="flex justify-between items-center text-xs text-gray-500 mt-2">
                                        <div class="flex items-center gap-2">
                                            <span>ÊúâÊïàÊúüÈôê: ${coupon.expiry}</span>
                                            ${regionTag}
                                        </div>
                                        ${iconHtml}
                                    </div>
                                </div>
                            `;
                            gridContainer.appendChild(card);
                        });
                        couponContainer.appendChild(gridContainer);
                    }
                });

                const sourceRemark = document.createElement('div');
                sourceRemark.className = 'md:col-span-2 text-center text-xs text-gray-500 mt-6';
                sourceRemark.innerHTML = `
                    source from : <a href="https://www.funtime.com.tw/blog/funtime/japan-coupon" target="_blank" rel="noopener noreferrer" class="underline hover:text-gray-400">https://www.funtime.com.tw/blog/funtime/japan-coupon</a>
                `;
                couponContainer.appendChild(sourceRemark);
            }
            
            function renderStaticComponents() {
                navContainer.innerHTML = `
                    <button id="nav-itinerary" class="flex flex-col items-center justify-center text-blue-400 p-4 w-1/3">
                        ${getIconSvg('list-ordered', { classes: 'w-7 h-7' })}
                    </button>
                    <button id="nav-foodie" class="flex flex-col items-center justify-center text-gray-400 p-4 w-1/3">
                        ${getIconSvg('utensils-crossed', { classes: 'w-7 h-7' })}
                    </button>
                    <button id="nav-coupon" class="flex flex-col items-center justify-center text-gray-400 p-4 w-1/3">
                        ${getIconSvg('ticket', { classes: 'w-7 h-7' })}
                    </button>
                `;
                
                couponModalContent.innerHTML = `
                    <img id="modal-coupon-image" src="" alt="ÂÑ™ÊÉ†Âà∏Â§ßÂúñ" class="w-full h-auto rounded-lg">
                    <button id="modal-close-button" class="absolute top-2 right-2 bg-gray-700 rounded-full p-1 text-gray-300 hover:bg-gray-600">
                        ${getIconSvg('x', { classes: 'w-6 h-6' })}
                    </button>
                `;
            }

            // --- Page Navigation ---
            function showDetailPage(dayIndex) {
                renderDetailPage(dayIndex, appState.weatherByLocation);
                detailPage.classList.remove('page-hidden');
                mainPageWrapper.classList.add('hidden');
            }

            function hideDetailPage() {
                detailPage.classList.add('page-hidden');
                mainPageWrapper.classList.remove('hidden');
            }
            
            // --- Gemini AI Function ---
            async function getAiFoodSuggestions() {
                const button = document.getElementById('get-ai-suggestions');
                const loader = document.getElementById('ai-suggestions-loader');
                const errorContainer = document.getElementById('ai-suggestions-error');
                const resultsContainer = document.getElementById('ai-suggestions-results');

                button.disabled = true;
                button.classList.add('opacity-50', 'cursor-not-allowed');
                loader.classList.remove('hidden');
                errorContainer.classList.add('hidden');
                resultsContainer.innerHTML = '';

                try {
                    const existingRegions = [...new Set(tripData.foodieList.map(item => item.region))];
                    const existingTags = [...new Set(tripData.foodieList.map(item => item.tag))];
                    
                    const prompt = `I am planning a trip to Japan, visiting these regions: ${existingRegions.join(', ')}. I enjoy food like: ${existingTags.join(', ')}. I do not eat seafood. Please suggest one new, highly-rated restaurant for each region that I might like. Provide the response as a JSON array. Each object in the array should have the following properties: "name" (the restaurant's name in Traditional Chinese), "region" (one of the provided regions), "tag" (a food category in Traditional Chinese), and "googleMapsQuery" (a string suitable for a Google Maps search).`;

                    let chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
                    const payload = {
                        contents: chatHistory,
                        generationConfig: {
                            responseMimeType: "application/json",
                            responseSchema: {
                                type: "ARRAY",
                                items: {
                                    type: "OBJECT",
                                    properties: {
                                        "name": { "type": "STRING" },
                                        "region": { "type": "STRING" },
                                        "tag": { "type": "STRING" },
                                        "googleMapsQuery": { "type": "STRING" }
                                    },
                                    required: ["name", "region", "tag", "googleMapsQuery"]
                                }
                            }
                        }
                    };
                    
                    const apiKey = "";
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
                    
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        throw new Error(`API request failed with status ${response.status}`);
                    }

                    const result = await response.json();
                    
                    if (result.candidates && result.candidates[0].content && result.candidates[0].content.parts[0]) {
                        const suggestions = JSON.parse(result.candidates[0].content.parts[0].text);
                        if(suggestions && suggestions.length > 0) {
                            resultsContainer.classList.add('mt-4');
                            suggestions.forEach(suggestion => {
                                const mapLink = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(suggestion.googleMapsQuery)}`;
                                const newItem = { ...suggestion, mapLink };
                                resultsContainer.appendChild(createFoodieCard(newItem, true));
                            });
                        }
                    } else {
                        throw new Error("Invalid response structure from API.");
                    }

                } catch (error) {
                    console.error("Error fetching AI suggestions:", error);
                    errorContainer.textContent = "ÁÑ°Ê≥ïÁç≤ÂèñÂª∫Ë≠∞ÔºåË´ãÁ®çÂæåÂÜçË©¶„ÄÇ";
                    errorContainer.classList.remove('hidden');
                } finally {
                    loader.classList.add('hidden');
                    button.disabled = false;
                    button.classList.remove('opacity-50', 'cursor-not-allowed');
                }
            }


            // --- (NEW) Centralized Event Listener Setup ---
            function setupEventListeners() {
                const appContainer = document.getElementById('app-container');

                appContainer.addEventListener('click', (e) => {
                    // Itinerary Card Click
                    const itineraryCard = e.target.closest('[data-day-index]');
                    if (itineraryCard) {
                        showDetailPage(itineraryCard.dataset.dayIndex);
                        return;
                    }

                    // Detail Page Back Button
                    if (e.target.closest('#back-button')) {
                        hideDetailPage();
                        return;
                    }

                    // Coupon Card Click
                    const couponCard = e.target.closest('.coupon-card');
                    if (couponCard) {
                        const url = couponCard.dataset.finalUrl;
                        const isImageUrl = /\.(jpeg|jpg|gif|png|webp|pdf)(\?.*)?$/i.test(url);
                        if (isImageUrl) {
                            couponModal.querySelector('#modal-coupon-image').src = url;
                            couponModal.classList.remove('hidden');
                        } else {
                            window.open(url, '_blank');
                        }
                        return;
                    }
                    
                    // Coupon Modal Close
                    if (e.target.closest('#modal-close-button') || e.target === couponModal) {
                        couponModal.classList.add('hidden');
                        return;
                    }

                    // AI Suggestions Button
                    const aiButton = e.target.closest('#get-ai-suggestions');
                    if (aiButton) {
                        getAiFoodSuggestions();
                        return;
                    }

                    // Bottom Navigation
                    const navButton = e.target.closest('button');
                    if (navButton && navContainer.contains(navButton)) {
                        const views = { itinerary: itineraryView, foodie: foodieView, coupon: couponView };
                        let activeTab = null;
                        if (navButton.id === 'nav-itinerary') activeTab = 'itinerary';
                        if (navButton.id === 'nav-foodie') activeTab = 'foodie';
                        if (navButton.id === 'nav-coupon') activeTab = 'coupon';

                        if (activeTab) {
                            Object.keys(views).forEach(key => {
                                const button = navContainer.querySelector(`#nav-${key}`);
                                const view = views[key];
                                if (key === activeTab) {
                                    view.classList.remove('hidden');
                                    button.classList.add('text-blue-400');
                                    button.classList.remove('text-gray-400');
                                } else {
                                    view.classList.add('hidden');
                                    button.classList.add('text-gray-400');
                                    button.classList.remove('text-blue-400');
                                }
                            });
                        }
                    }
                });
            }

            // --- Initial Render ---
            function initialize() {
                mainTitle.textContent = tripData.tripTitle;
                renderStaticComponents();
                
                // Render content first for instant UI
                renderItinerary();
                renderFoodieList();
                renderCoupons();

                // Setup all event listeners
                setupEventListeners();

                // Fetch weather in the background and update UI when done
                fetchAllWeatherData(tripData.locations, tripData.itinerary).then(weatherData => {
                    appState.weatherByLocation = weatherData;
                    updateWeatherUI(weatherData);
                });
            }

            initialize();
        });
    </script>
</body>
</html>
